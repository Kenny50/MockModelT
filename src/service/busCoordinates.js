//Excel data specific all bus state image update location
const busCoordinates = [
    [22.923020803224833, 120.28519642352616],
    [22.923596253623863, 120.28475711659884],
    [22.924115583050952, 120.28424343405165],
    [22.92482751814116, 120.28427247058985],
    [22.925498679800352, 120.28398547422334],
    [22.926161230187148, 120.28368673060542],
    [22.92586478967339, 120.28297594521291],
    [22.92561135159823, 120.28227003011067],
    [22.925727306835395, 120.2817160703369],
    [22.926365058865684, 120.28139502546799],
    [22.927015534075846, 120.28103824153855],
    [22.927687989205836, 120.28222045554978],
    [22.92796045378263, 120.28291875748214],
    [22.92823766673627, 120.28364232867676],
    [22.928542955974265, 120.28449561460758],
    [22.928819252493028, 120.28510653443891],
    [22.929122608282697, 120.28584189654141],
    [22.929467388537404, 120.2865715143875],
    [22.92972240724039, 120.28726884282658],
    [22.93001926049772, 120.28798708499778],
    [22.92944929578377, 120.28834281665637],
    [22.928895475415136, 120.28851189961429],
    [22.928299811364184, 120.28884255959315],
    [22.927989171684484, 120.28812669956554],
    [22.927721789941767, 120.28741048560039],
    [22.927419890620254, 120.2866901418152],
    [22.927082693767844, 120.28594747205766],
    [22.926851463113255, 120.2852667573811],
    [22.926243102170908, 120.2853182875088],
    [22.925582377639163, 120.28565270052223],
    [22.924950206500903, 120.28599182607293],
    [22.924288401862267, 120.28634834938099],
    [22.923626304185298, 120.28665818382109],
    [22.9229996839797, 120.28701316859478],
    [22.923058628150486, 120.28759883401167],
    [22.923180148345097, 120.28797642714645],
    [22.92348251781242, 120.28868007220696],
    [22.923799269963457, 120.28940798698471],
    [22.92408107131838, 120.29011885558904],
    [22.92436481692312, 120.29083496557517],
    [22.924664377825795, 120.29152076903077],
    [22.92496228318627, 120.29224619960917],
    [22.925264805157955, 120.29295475007076],
    [22.925564675918302, 120.29368718236921],
    [22.925260208095143, 120.29415271307766],
    [22.92459483477648, 120.29447906498275],
    [22.923914661605668, 120.29477598417024],
    [22.923258892592045, 120.29510237831721],
    [22.922598115166632, 120.29544616953275],
    [22.921940577134993, 120.2957828355603],
    [22.92134015463, 120.29583765370394],
    [22.921088229059873, 120.29508883182466],
    [22.920835177036434, 120.29433670771715],
    [22.920574707868376, 120.29359880617548],
    [22.920330416253027, 120.29285080262112],
    [22.920068429907424, 120.29211455854391],
    [22.91982119737281, 120.2913922703945],
    [22.919686043496547, 120.29104864134364],
    [22.919416690343674, 120.29031326366062],
    [22.919148009182518, 120.28957709588316],
    [22.918885506802297, 120.28884178677033],
    [22.918590938922257, 120.28811302580377],
    [22.91829755944804, 120.28739162474224],
    [22.917995916221862, 120.28666950833069],
    [22.917700200094878, 120.2859515137944],
    [22.917400466645294, 120.28522320825141],
    [22.917290277445186, 120.28449841689233],
    [22.917557638687615, 120.28376074870158],
    [22.91785314625965, 120.28302832182598],
    [22.918123083134507, 120.28228253808756],
    [22.918428370521916, 120.28166205052997],
    [22.91909751499871, 120.28194240399634],
    [22.919761442922272, 120.28222977661673],
    [22.920447577754285, 120.2825148457921],
    [22.921112374735056, 120.28284217093518],
    [22.921591738444068, 120.28329321193097],
    [22.921750144733338, 120.28405255996542],
    [22.92186456637228, 120.28441624786811],
    [22.922061574173874, 120.28512912345867],
    [22.922391139283345, 120.28554164120237],
    [22.922967843081402, 120.2852519002703]
];

//find nearest bus coordinate, then get its index, it should refer to image order
function findNearestIndex(message) {
    const inputCoordinates = JSON.parse(message).location;

    //算出現在的點和所有點的距離
    const distances = busCoordinates.map((coordinate) => {
        const x1 = inputCoordinates[0];
        const y1 = inputCoordinates[1];
        const x2 = coordinate[0];
        const y2 = coordinate[1];
        return Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2);
    });
    // Find the index of the data coordinate with the minimum distance.
    // 找出距離最短的點
    const minD = Math.min(...distances)
    // 找出該點的 index
    const minIndex = distances.indexOf(minD);

    // Return the index of the nearest coordinate.
    return minIndex;
}


module.exports = findNearestIndex;